<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estratégia Ypê - Mapa Colaborativo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        /* Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- CONFIGURAÇÃO DO FIREBASE -->
    <script type="module">
        // Importa as funções necessárias do CDN do Google
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAqZK2CndUqHQ2meBxR7TrA5AiScWphS40",
            authDomain: "planejamento-ype.firebaseapp.com",
            projectId: "planejamento-ype",
            storageBucket: "planejamento-ype.firebasestorage.app",
            messagingSenderId: "759028249794",
            appId: "1:759028249794:web:386c91ceb5577c00f8b75b"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Expõe o banco de dados e funções para o React (que roda no script babel abaixo)
        window.firebaseDB = db;
        window.firebaseDoc = doc;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;

        // Dispara evento avisando que o Firebase está pronto
        window.dispatchEvent(new Event('firebase-ready'));
    </script>

    <!-- APLICAÇÃO REACT -->
    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;

        // --- ÍCONES ---
        const Icon = ({ path, className, style }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
                {path}
            </svg>
        );

        const Icons = {
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            Layout: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></>} />,
            Type: (props) => <Icon {...props} path={<><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></>} />,
            ZoomIn: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="11" x2="11" y1="8" y2="14"/><line x1="8" x2="14" y1="11" y2="11"/></>} />,
            ZoomOut: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="8" x2="14" y1="11" y2="11"/></>} />,
            Maximize: (props) => <Icon {...props} path={<><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></>} />,
            Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            Layers: (props) => <Icon {...props} path={<><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></>} />,
            Play: (props) => <Icon {...props} path={<polygon points="5 3 19 12 5 21 5 3"/>} />,
            BarChart3: (props) => <Icon {...props} path={<><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></>} />,
            MousePointer2: (props) => <Icon {...props} path={<path d="m12 6 2-2-2-2-2 2 2 2zm0 12-2 2 2 2 2-2-2-2zm-6-6-2-2-2 2 2 2 2-2zm12 0 2-2 2 2-2 2 2-2z"/>} />, 
            AlignLeft: (props) => <Icon {...props} path={<><line x1="21" x2="3" y1="6" y2="6"/><line x1="15" x2="3" y1="12" y2="12"/><line x1="17" x2="3" y1="18" y2="18"/></>} />,
            Link: (props) => <Icon {...props} path={<><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            RotateCcw: (props) => <Icon {...props} path={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} />,
            Cloud: (props) => <Icon {...props} path={<path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19h11zm-5.5 0V9m0 0l-3 3m3-3l3 3"/>} />,
            CloudCheck: (props) => <Icon {...props} path={<><path d="M12 10v6m0 0l-3-3m3 3l3-3"/><path d="M4 16.2a10 10 0 0 1 19.4 0"/></>} /> 
        };

        // --- TEMAS ---
        const THEMES = {
            blue: { main: '#2563eb', light: '#eff6ff', border: '#bfdbfe', label: 'Liderar' },
            pink: { main: '#db2777', light: '#fdf2f8', border: '#fbcfe8', label: 'Cuidar' },
            purple: { main: '#9333ea', light: '#faf5ff', border: '#e9d5ff', label: 'Inovar' },
            yellow: { main: '#ca8a04', light: '#fefce8', border: '#fef08a', label: 'Se Mostrar' },
            green: { main: '#16a34a', light: '#f0fdf4', border: '#bbf7d0', label: 'Crescer' },
            slate: { main: '#475569', light: '#f8fafc', border: '#e2e8f0', label: 'Produzir' },
            orange: { main: '#ea580c', light: '#fff7ed', border: '#fed7aa', label: 'Aprender' },
            teal: { main: '#0d9488', light: '#ccfbf1', border: '#5eead4', label: 'Comunicar' },
            indigo: { main: '#4f46e5', light: '#e0e7ff', border: '#818cf8', label: 'Desenvolver' },
            rose: { main: '#e11d48', light: '#ffe4e6', border: '#fda4af', label: 'Digitalizar' },
            cyan: { main: '#06b6d4', light: '#cffafe', border: '#67e8f9', label: 'Reconhecer' },
            stone: { main: '#78716c', light: '#f5f5f4', border: '#a8a29e', label: 'Implementar?' },
            lime: { main: '#65a30d', light: '#ecfccb', border: '#a3e635', label: 'Compartilhar?' },
            fuchsia: { main: '#c026d3', light: '#fae8ff', border: '#e879f9', label: 'Atrair?' },
        };

        // --- SEED DATA (Usado apenas se o banco estiver vazio) ---
        // (Aqui mantemos a estrutura completa que construímos)
        const INITIAL_NODES_DATA = [
            { id: '1', type: 'dimension', label: 'Liderar', x: 0, y: 780, color: 'blue' },
            { id: '1-1', type: 'attribute', label: 'Pessoas', x: 300, y: 200, color: 'blue' },
            { id: '1-1-1', type: 'action', label: 'Atuação alinhada aos valores', description: 'Avaliação de performance com foco em comportamentos\nValores Ypê: Trabalho com Disciplina', x: 600, y: 200, color: 'blue' },
            { id: '1-1-1-k', type: 'kpi', label: 'Indice da liderança', x: 900, y: 200, color: 'blue' },
            { id: '1-1-2', type: 'action', label: 'Desenvolvimento de pessoas', description: 'Avaliação do time, alcance de resultados, Feedbacks dados\nValores Ypê: Trabalho com Disciplina', x: 600, y: 320, color: 'blue' },
            { id: '1-1-2-k', type: 'kpi', label: 'Indice da liderança', x: 900, y: 320, color: 'blue' },
            { id: '1-1-3', type: 'action', label: 'Ter as pessoas certas nos lugares certos', description: 'Calibração de Performance, Rituais Ciclo de gente\nValores Ypê: Trabalho com Disciplina', x: 600, y: 440, color: 'blue' },
            { id: '1-1-4', type: 'action', label: 'Liderança Ypê', description: 'Academia de Liderança / Programa de Desenvolvimento da Liderança PDL) / Coaching em grupo 70 em 7\nValores Ypê: Humildade', x: 600, y: 560, color: 'blue' },
            { id: '1-2', type: 'attribute', label: 'Mercado', x: 300, y: 820, color: 'blue' },
            { id: '1-2-1', type: 'action', label: 'Construção de marca de sabonetes, distribuição de produto e execução PDV', description: '', x: 600, y: 820, color: 'blue' },
            { id: '1-2-1-k', type: 'kpi', label: 'Volume Sellout, receita líquida, EBTDA', x: 900, y: 820, color: 'blue' },
            { id: '1-2-2', type: 'action', label: 'Revisão do processo de qualidade, inauguração do laboratório de microbiologia, investir na área fabril. reciclar e treinar as pessoas em qualidade', description: '', x: 600, y: 940, color: 'blue' },
            { id: '1-2-2-k', type: 'kpi', label: 'indicadores de qualidade', x: 900, y: 940, color: 'blue' },
            { id: '1-2-3', type: 'action', label: 'Investimento em novos CDs', description: '', x: 600, y: 1060, color: 'blue' },
            { id: '1-2-4', type: 'action', label: 'Melhorar atendimento aos clientes', description: '', x: 600, y: 1180, color: 'blue' },
            { id: '1-2-5', type: 'action', label: 'Melhorar categorias com a melhora da gestão de incentivos da equipe', description: '', x: 600, y: 1300, color: 'blue' },
            { id: '1-2-5-k', type: 'kpi', label: 'crescimento de vendas das categorias', x: 900, y: 1300, color: 'blue' },
            { id: '1-2-6', type: 'action', label: 'Programa Excelência Comercial', description: '', x: 600, y: 1420, color: 'blue' },
            { id: '2', type: 'dimension', label: 'Cuidar', x: 0, y: 3990, color: 'pink' },
            { id: '2-1', type: 'attribute', label: 'Clientes (consumidor é nosso patrão)', x: 300, y: 1940, color: 'pink' },
            { id: '2-1-1', type: 'action', label: 'Qualidade dos produtos', description: 'Qualidade de ponta a ponta e fazer certo da primeira vez\n Diagnóstico de Maturidade da Qualidade\nFluxo de Revisão de Projetos em todas as \nfrentes (VMO)\nprojeto de IA SAC/CRM\nSEY\nValores Ypê: Qualidade de ponta a ponta', x: 600, y: 1940, color: 'pink' },
            { id: '2-1-1-k', type: 'kpi', label: 'SAC\nCRM\nÍndice de Qualidade (IQF, PTP, BPF, ATD)\nCusto de não qualidade', x: 900, y: 1940, color: 'pink' },
            { id: '2-1-2', type: 'action', label: 'Proximidade com o cliente', description: 'Programa/Iniciativa Rota / Embaixadores Ypê / Inclusão no onboarding de visita na fábrica e rotas nos mercados', x: 600, y: 2060, color: 'pink' },
            { id: '2-1-3', type: 'action', label: 'Satisfação do cliente, olhando preço, qualidade e inovação', description: '', x: 600, y: 2180, color: 'pink' },
            { id: '2-2', type: 'attribute', label: 'Colaboradores', x: 300, y: 2440, color: 'pink' },
            { id: '2-2-1', type: 'action', label: 'Saúde', description: 'Programa Cuidar (Social, Psicólogo, Médico da Família, Financeiro)', x: 600, y: 2440, color: 'pink' },
            { id: '2-2-2', type: 'action', label: 'Saúde', description: 'Censo Saúde Mental', x: 600, y: 2560, color: 'pink' },
            { id: '2-2-3', type: 'action', label: 'Saúde', description: 'Programa de Saúde Integral  (Saúde laboral / palestras/ centro de saúde para exames admissionais/periódicos e demissionais, além de atendimentos de rotina/ Container da saúde com ações de saúde preventiva)', x: 600, y: 2680, color: 'pink' },
            { id: '2-2-3-k', type: 'kpi', label: 'Redução do absenteísmo e uso do plano de saúde', x: 900, y: 2680, color: 'pink' },
            { id: '2-2-4', type: 'action', label: 'Segurança', description: 'Programa de Segurança com a Dupont que está iniciando em 2026. Projeto de longo prazo (4 anos).', x: 600, y: 2800, color: 'pink' },
            { id: '2-2-5', type: 'action', label: 'Escuta', description: 'Pesquisas de engajamento (Pulsa, GPTW)', x: 600, y: 2920, color: 'pink' },
            { id: '2-2-6', type: 'action', label: 'Escuta', description: 'Caixa de Sugestões e Selo Você pediu, a gente ouviu', x: 600, y: 3040, color: 'pink' },
            { id: '2-2-7', type: 'action', label: 'Escuta', description: 'Encontros com a liderança (lives)', x: 600, y: 3160, color: 'pink' },
            { id: '2-2-8', type: 'action', label: 'Escuta', description: 'Rodas de Conversa', x: 600, y: 3280, color: 'pink' },
            { id: '2-2-9', type: 'action', label: 'Escuta', description: 'Café da manhã na fábrica', x: 600, y: 3400, color: 'pink' },
            { id: '2-2-10', type: 'action', label: 'Engajamento', description: 'Olimpíadas Ypê', x: 600, y: 3520, color: 'pink' },
            { id: '2-2-11', type: 'action', label: 'Engajamento', description: 'Dia da Familia', x: 600, y: 3640, color: 'pink' },
            { id: '2-2-12', type: 'action', label: 'Reconhecimento', description: '(Programa Cultivar) Atitude, Gratidão, Projetos Destaque e Ydealize', x: 600, y: 3760, color: 'pink' },
            { id: '2-2-13', type: 'action', label: 'Reconhecimento', description: 'Mérito de acordo com avaliação de performance', x: 600, y: 3880, color: 'pink' },
            { id: '2-2-14', type: 'action', label: 'Engajamento', description: 'cesta de produtos para família', x: 600, y: 4000, color: 'pink' },
            { id: '2-2-15', type: 'action', label: 'Diversidade e Inclusão', description: 'Foco em Mulheres na Liderança', x: 600, y: 4120, color: 'pink' },
            { id: '2-2-16', type: 'action', label: 'Diversidade e Inclusão', description: 'Atração PCD', x: 600, y: 4240, color: 'pink' },
            { id: '2-2-17', type: 'action', label: 'Desenvolvimento', description: 'Ciclo de Gente (Indicação de pares / Avaliação / mérito / Feedback PDI / Check de desempenho / calibragem / Acompanhamento de avaliações)', x: 600, y: 4360, color: 'pink' },
            { id: '2-2-17-k', type: 'kpi', label: 'Quantidade de avaliações feitas em sistema x número de colaboradores (100% dos colaboradores são elegíveis)', x: 900, y: 4360, color: 'pink' },
            { id: '2-2-18', type: 'action', label: 'Experiência', description: 'Revitaliza RH - nova plataforma digital para Folha, Ciclo, Educação)', x: 600, y: 4480, color: 'pink' },
            { id: '2-2-19', type: 'action', label: 'Experiência', description: 'Avaliação contínua da obsolescência de equipamentos e troca a cada 4 anos (computador) e 3 anos (celular)\nTimes responsáveis: Time IT', x: 600, y: 4600, color: 'pink' },
            { id: '2-2-19-k', type: 'kpi', label: 'Avaliação de colaboradores, engajamento. Indicador de Total Experience.', x: 900, y: 4600, color: 'pink' },
            { id: '2-2-20', type: 'action', label: 'Experiência', description: 'Limitação para uso de novos sistemas de IT e conexão entre sistemas\nValores Ypê: Simplicidade\nTimes responsáveis: Time IT', x: 600, y: 4720, color: 'pink' },
            { id: '2-2-20-k', type: 'kpi', label: 'Quantidade de sistemas existentes, implementação de novos sistemas; melhora do indicador de Total Experience.', x: 900, y: 4720, color: 'pink' },
            { id: '2-2-21', type: 'action', label: 'Chegada', description: 'Onboarding KIT IT e acessos para sistemas. Existe um levantamento padrão para tipo de cargo e equipamento necessário, para agilizar a entrega. O mesmo vale para acessos, que também são padronizados por função.\nTimes responsáveis: Time de IT', x: 600, y: 4840, color: 'pink' },
            { id: '2-2-22', type: 'action', label: 'Chegada', description: 'Onboarding Kit Boas vindas com squeeze, cordão de crachá, caderno)\nTimes responsáveis: Time de gente', x: 600, y: 4960, color: 'pink' },
            { id: '2-2-23', type: 'action', label: 'Chegada', description: 'Programa de Integração de Operações\nTimes responsáveis: Time de gente', x: 600, y: 5080, color: 'pink' },
            { id: '2-2-24', type: 'action', label: 'Reconhecimento', description: 'Promoção e Comitê de Carreira para coordenadores', x: 600, y: 5200, color: 'pink' },
            { id: '2-3', type: 'attribute', label: 'Equipamentos', x: 300, y: 5460, color: 'pink' },
            { id: '2-3-1', type: 'action', label: 'TPM', description: 'Programa de Conservação Autônoma TPM\nTimes responsáveis: Time de Melhoria Contínua', x: 600, y: 5460, color: 'pink' },
            { id: '2-3-1-k', type: 'kpi', label: 'Evolução em passos do programa (5 passos)', x: 900, y: 5460, color: 'pink' },
            { id: '2-4', type: 'attribute', label: 'Infraestrutura', x: 300, y: 5720, color: 'pink' },
            { id: '2-4-1', type: 'action', label: 'Equipamentos de IT e infraestrutura de produção e plantas; telecomunicações; servidores e banco de dados', description: 'Avaliação contínua de capacidade de equipamentos  e obsolescência, com planejamento de atualização e troca seguindo calendário e renovações tecnológicas.\nTimes responsáveis: Time de TI', x: 600, y: 5720, color: 'pink' },
            { id: '2-4-2', type: 'action', label: 'Sistemas', description: 'Gestão de sistemas (SAP, gente, robôs na logística); gestão de acesso de colaboradores', x: 600, y: 5840, color: 'pink' },
            { id: '2-4-2-k', type: 'kpi', label: 'Acompanhamento de atritos por usuário, chamados no front office. Existe um padrão para hierarquização de chamados (sales force/vendas - robôs/logística - VIPs e chamados gerais). Acompanhamento via indicador de Total Experience.', x: 900, y: 5840, color: 'pink' },
            { id: '2-5', type: 'attribute', label: 'Comunidade', x: 300, y: 6100, color: 'pink' },
            { id: '2-5-1', type: 'action', label: 'Proximidade com a comunidade', description: 'Programa de Visitas Você na Ypê', x: 600, y: 6100, color: 'pink' },
            { id: '2-5-1-k', type: 'kpi', label: 'Percepção de marca no quesito sustentabilidade (social)', x: 900, y: 6100, color: 'pink' },
            { id: '3', type: 'dimension', label: 'Inovar', x: 0, y: 7820, color: 'purple' },
            { id: '3-1', type: 'attribute', label: 'Melhoria contínua', x: 300, y: 6620, color: 'purple' },
            { id: '3-1-1', type: 'action', label: 'TPM', description: 'Dar ideias de melhoria pelo Projeto Ydealize (parte do projeto Cultivar)', x: 600, y: 6620, color: 'purple' },
            { id: '3-1-1-k', type: 'kpi', label: 'Projeto Estagiários corporativos desenvolvendo ideias do Ydealize para fazer os projetos  de melhoria acontecerem', x: 900, y: 6620, color: 'purple' },
            { id: '3-1-2', type: 'action', label: 'TPM', description: 'PDCA', x: 600, y: 6740, color: 'purple' },
            { id: '3-1-3', type: 'action', label: 'TPM', description: 'Projeto e Registro de Anomalias', x: 600, y: 6860, color: 'purple' },
            { id: '3-1-4', type: 'action', label: 'TPM', description: 'Grupos de Melhoria de Resultado', x: 600, y: 6980, color: 'purple' },
            { id: '3-1-5', type: 'action', label: 'TPM', description: 'GIGA (gestão autônoma)', x: 600, y: 7100, color: 'purple' },
            { id: '3-1-6', type: 'action', label: 'TPM', description: 'Banco de ideias', x: 600, y: 7220, color: 'purple' },
            { id: '3-1-7', type: 'action', label: 'Digitalizar e novos sistemas', description: 'Necessidades vindas so planejamento estratégico do negócio, que passam por IT ir ao mercado, realização de avaliação técina, segurança da informação e visão de negócio para implementação. Existe a premissa de menor número possível de sistemas e que haja conexão com os sistemas existentes. Ex. nova extranet e nova Ypênet, que são "máscaras" que trazem uma única visão para o usuário, mesmo que haja diversos sistemas no backoffice correndo em paralelo).\nTimes responsáveis: Time de IT', x: 600, y: 7340, color: 'purple' },
            { id: '3-1-7-k', type: 'kpi', label: 'Quantidade de sistemas', x: 900, y: 7340, color: 'purple' },
            { id: '3-1-8', type: 'action', label: 'Digitalizar e novos sistemas', description: 'Atualizações podem vir também por análise de obsolecência, com acompanhamento feito pelo time de IT e por entendimento de novas tecnologias no mercado. Então são sugeridas para o negócio.\nTimes responsáveis: Time de IT', x: 600, y: 7460, color: 'purple' },
            { id: '3-1-8-k', type: 'kpi', label: 'Produtividade; redução de atritos, melhor experiência', x: 900, y: 7460, color: 'purple' },
            { id: '3-2', type: 'attribute', label: 'Viver a inovação', x: 300, y: 7720, color: 'purple' },
            { id: '3-2-1', type: 'action', label: 'Oficinas de Ideias', description: 'Reuniões que fazem parte da governança de novos projetos, separados por temas e sponsors específicos. Há oficina de novos produtos, engenharia, processos e transformação digital). Elas têm governanças independentes, mas são interconectadas.', x: 600, y: 7720, color: 'purple' },
            { id: '3-2-1-k', type: 'kpi', label: 'Revitaliza RH - nova plataforma digital para Folha, Ciclo, Educação)', x: 900, y: 7720, color: 'purple' },
            { id: '3-2-2', type: 'action', label: 'Oficinas de Ideias', description: 'Fórum de validação que define se as ideias seguem ou não para implementação.', x: 600, y: 7840, color: 'purple' },
            { id: '3-2-3', type: 'action', label: 'Dia Y', description: 'Hackaton para ideação para atender a dores levantadas pelo negócio', x: 600, y: 7960, color: 'purple' },
            { id: '3-2-4', type: 'action', label: 'Imersão nas Áreas + Design Thinking', description: '', x: 600, y: 8080, color: 'purple' },
            { id: '3-2-5', type: 'action', label: 'Novos negócios', description: 'Fluxo acontece somente via Conselho/Família/Alto executivos, com pouco visibilidade dos demais', x: 600, y: 8200, color: 'purple' },
            { id: '3-3', type: 'attribute', label: 'Mentalidade', x: 300, y: 8460, color: 'purple' },
            { id: '3-3-1', type: 'action', label: 'Aprender competências para o futuro', description: '(UnYpê) Aprender sobre inovação, dados e mentalidade digital. Trilha de capacitação de dados.', x: 600, y: 8460, color: 'purple' },
            { id: '3-3-2', type: 'action', label: 'Aprender competências para o futuro', description: 'Ype Talks', x: 600, y: 8580, color: 'purple' },
            { id: '3-4', type: 'attribute', label: 'Novas tecnologias', x: 300, y: 8840, color: 'purple' },
            { id: '3-4-1', type: 'action', label: 'Inteligência Articifial', description: 'Comitê de Inteligência Artificial', x: 600, y: 8840, color: 'purple' },
            { id: '3-4-2', type: 'action', label: 'Inteligência Articifial', description: 'Yara (IA da Ypê)', x: 600, y: 8960, color: 'purple' },
            { id: '3-4-3', type: 'action', label: 'Inteligência Articifial', description: 'Oficina de Tecnologia', x: 600, y: 9080, color: 'purple' },
            { id: '4', type: 'dimension', label: 'Agir com responsabilidade', x: 0, y: 11230, color: 'yellow' },
            { id: '4-1', type: 'attribute', label: 'Ética', x: 300, y: 9600, color: 'yellow' },
            { id: '4-1-1', type: 'action', label: 'Be Compliance', description: 'Canal de Ética Ypê', x: 600, y: 9600, color: 'yellow' },
            { id: '4-1-2', type: 'action', label: 'Be Compliance', description: 'Comitê de integridade', x: 600, y: 9720, color: 'yellow' },
            { id: '4-1-3', type: 'action', label: 'Be Compliance', description: 'Código de Conduta', x: 600, y: 9840, color: 'yellow' },
            { id: '4-1-4', type: 'action', label: 'Be Compliance', description: 'Agentes de Conformidade', x: 600, y: 9960, color: 'yellow' },
            { id: '4-1-5', type: 'action', label: 'Compliance e Anti Corrupção', description: 'Selo Pró Etica concedido pela CGU - Corregedoria Geral da União  (Vigência até 2023) / Pacto Empresarial pela Integridade contra corrupção', x: 600, y: 10080, color: 'yellow' },
            { id: '4-2', type: 'attribute', label: 'Reputação', x: 300, y: 10340, color: 'yellow' },
            { id: '4-2-1', type: 'action', label: 'Ser e parecer – equalizar valor percebido', description: 'Garantir que a percepção do consumidor esteja alinhada com a qualidade e benefícios dos nossos produtos para que possamos posicionar corretamente o produto no mercado, assegurando rentabilidade \n• Evoluir área de pricing\n• Fortalecer e posicionar a marca Ypê para garantir a percepção de "vale mais do que custa \n• Garantir que os atributos, claims e embalagens sejam alavancas para valorização e consolidação do portfólio de produtos e inovações\n • Garantir excelência na qualidade dos produtos, assegurando padrões rigorosos em insumos, processos, inovação e execução, para entregar performance e valor ao consumidor\n • Ativar o protocolo do war game de lava roupas (LRP e LRL) conforme movimentações da concorrência\n\n- Projeto Embaixadores (colaboradores Embaixadores)\n- Movimento Transparência 100%: Programa do nosso jeito, do jeito certo, capacitações, pacto empresarial pela integridade, contra a corrupção))', x: 600, y: 10340, color: 'yellow' },
            { id: '4-2-1-k', type: 'kpi', label: '% MC \n% MCC Aderência a Política de Preços \nSell-Out Share Valor \nPlano de mitigação \nShare Volume LRP \nTixan Share Volume LRL \nTixan Share Volume Amaciante Tradicional \nShare Volume Amaciante Concentrado \nEvolução do valor percebido da marca no raking de brand power \nROL Baseline Meta (2026) Real (YTD)', x: 900, y: 10340, color: 'yellow' },
            { id: '4-2-2', type: 'action', label: 'Nacionalidade', description: 'projeto de posicionamento para Marca Corporativa', x: 600, y: 10460, color: 'yellow' },
            { id: '4-3', type: 'attribute', label: 'Sustentabilidade', x: 300, y: 10720, color: 'yellow' },
            { id: '4-3-1', type: 'action', label: 'Apropriar-se de sustentabilidade com intenção e no centro do negócio para gerar resultados e diferenciação competitiva', description: 'plano diretor de sustentabilidade  UN PActo global  Publicação voluntária do Relatório de Sustentabilidade', x: 600, y: 10720, color: 'yellow' },
            { id: '4-3-2', type: 'action', label: 'Meio Ambiente', description: 'Movimento + água (diversas iniciativas) / Selo Ouro no Programa Brasileiro de GHG Protocol', x: 600, y: 10840, color: 'yellow' },
            { id: '4-3-3', type: 'action', label: 'Meio Ambiente', description: 'Reforço das práticas já adotadas, com evolução nas ações de documentação para adquirir a ISO 14.001 (processo já iniciado em Amparo)\nTimes responsáveis: Utilidades (Edwards)', x: 600, y: 10960, color: 'yellow' },
            { id: '4-3-4', type: 'action', label: 'Meio Ambiente', description: 'Uso responsável de energia (majoritariamente energia limpa - eólica e hidrelétrica)\nTimes responsáveis: Utilidades (Edwards)', x: 600, y: 11080, color: 'yellow' },
            { id: '4-3-5', type: 'action', label: 'Meio Ambiente', description: 'Tratamento de água para uso da produção (revisão de processos e métodos pelo projeto NEXUS) - um dos pontos que pode ter levado à contaminação\nTimes responsáveis: Utilidades (Edwards)', x: 600, y: 11200, color: 'yellow' },
            { id: '4-3-6', type: 'action', label: 'Responsabilidade Social', description: 'Movimento Mente em Foco', x: 600, y: 11320, color: 'yellow' },
            { id: '4-3-7', type: 'action', label: 'Colaboradores e Família', description: 'Programa Cuidar (Social, Psicólogo Médico da Família, Financeiro)', x: 600, y: 11440, color: 'yellow' },
            { id: '4-3-8', type: 'action', label: 'Responsabilidade Social', description: 'Movimento Educa2030', x: 600, y: 11560, color: 'yellow' },
            { id: '4-3-9', type: 'action', label: 'Colaboradores e Família', description: 'Educary, EducaYpê, Unico Skill (porque pega família)', x: 600, y: 11680, color: 'yellow' },
            { id: '4-3-10', type: 'action', label: 'Responsabilidade Social', description: 'Programa de Volntariado', x: 600, y: 11800, color: 'yellow' },
            { id: '4-3-11', type: 'action', label: 'Responsabilidade Social', description: 'Doação e patrocínio com contrapartidas sociais', x: 600, y: 11920, color: 'yellow' },
            { id: '4-3-12', type: 'action', label: 'Responsabilidade Social', description: 'Lei de Incentivo', x: 600, y: 12040, color: 'yellow' },
            { id: '4-4', type: 'attribute', label: 'Marca', x: 300, y: 12300, color: 'yellow' },
            { id: '4-4-1', type: 'action', label: 'Employer branding', description: 'Premiação GPTW', x: 600, y: 12300, color: 'yellow' },
            { id: '4-4-2', type: 'action', label: 'Qualidade?', description: 'Nossa melhor propaganda é a qualidade', x: 600, y: 12420, color: 'yellow' },
            { id: '4-5', type: 'attribute', label: 'Inclusão e Diversidade', x: 300, y: 12680, color: 'yellow' },
            { id: '4-5-1', type: 'action', label: 'Inclusão', description: 'Rede Empresarial de Inclusão Social (REIS) / PActo pela Inclusão', x: 600, y: 12680, color: 'yellow' },
            { id: '4-5-2', type: 'action', label: 'Mulheres', description: 'Selo Pró-Ética Mulheres / Encontros Mulheres Essenciais / Woman on Board / Programa Mais Elas', x: 600, y: 12800, color: 'yellow' },
            { id: '4-5-3', type: 'action', label: 'PCD', description: 'Programa Aprendizes / Projeto Promotor com Deficiência', x: 600, y: 12920, color: 'yellow' },
            { id: '5', type: 'dimension', label: 'Crescer', x: 0, y: 14100, color: 'green' },
            { id: '5-1', type: 'attribute', label: 'Expansão', x: 300, y: 13440, color: 'green' },
            { id: '5-1-1', type: 'action', label: 'Uma Ype em cada região', description: 'Atuar regionalmente como unidades de negócio para ganho de mercado \n• Portfólio e comunicação regionalizados (Claims de superioridade vs concorrentes locais) \n• Revisar a malha produtiva e logística para elevar o nível de serviço tornando-se referência regionalmente \n• Potencializar atendimento de vendas e merchandising para ganhar mercado com rentabilidade nas regionais \n• Evoluir o atendimento financeiro para maximizar/destravar oportunidades regionais \n• Gerir cada regional com unidade de negócio com total responsabilidade pela DRE (ponta a ponta) \n• Garantir analytics e inteligência de vendas regionalizada', x: 600, y: 13440, color: 'green' },
            { id: '5-1-1-k', type: 'kpi', label: 'Margem de servir \nOTIF \nDistribuição de inovação por região \nYperexecução por região \nROL Share regional', x: 900, y: 13440, color: 'green' },
            { id: '5-1-2', type: 'action', label: 'Capacidade fabril e centros de distribuição', description: 'Gestão de capacidade para acompanhar crescimento puxado pelos direcionadores estratégicos em termos de maquinário, sistemas e infraestrutura. O método muitas vezes é reativo puxado por mudanças repentinas, que permitem baixa capacidade de manobra, negociação.\nTimes responsáveis: Time Área Técnica', x: 600, y: 13560, color: 'green' },
            { id: '5-1-3', type: 'action', label: 'Capacidade de sistemas e infraestrutura', description: 'Gestão dos sistemas e equipamentos de IT para acompanhar as necessidade de crescimento do plano estratégico\nTimes responsáveis: Time IT', x: 600, y: 13680, color: 'green' },
            { id: '5-1-4', type: 'action', label: 'A Ypê está onde o consumidor está', description: 'Ampliar a relevância da Ypê na jornada do consumidor por meio de oferta de produtos e soluções de limpeza e cuidados pessoais \n• Disponibilidade física (omnicanalidade da jornada):\n ▪ Avaliar e estruturar atuação em novos canais - Food service, Lavanderia, Perfumaria, Digitais, Exportação. \n▪ Aprofundar estudo para evolução para serviços/soluções na construção de um ecossistema \n• Comunicação/Disponibilidade mental: \n▪ Evoluir a estratégia de comunicação para aumentar a lembrança e preferência das marcas do portfólio. \n▪ Atuar mais ativa e organicamente nas conversas de redes sociais como parte da vida do nosso consumido. \n▪ Comunicar claramente o diferencial de qualidade e benefício para elevar a percepção de valor e nos tornar referência em solução de limpeza do lar. \n▪ Construir as marcas de cuidados pessoais para conquistar nossa relevância como player do setor.', x: 600, y: 13800, color: 'green' },
            { id: '5-1-4-k', type: 'kpi', label: 'Brand Power \n% ROL novos canais (acompanhar mesmo que a meta esteja em construção) \nTrazer indicadores do digital Investimento/ROI de mídia? (temos % propaganda/ROL)', x: 900, y: 13800, color: 'green' },
            { id: '5-1-5', type: 'action', label: 'Foco no consumidor muda o jogo', description: 'Roupas – 15 | 15 | 30 | 30 (% share volume em AC, LRL, LRP até 2030) \nCasa - Alcançar a 3º posição em share volume, 2º em share valor, com mínimo de 10% do mercado produtos limpeza da casa \nPia – atingir 41% de share volume em produtos para lavagem de louça até 2030 deo, sab liq e hidratante – banho estendido) até 2030 \n– Ser a segunda marca em volume de sabonete barra; ampliar portfolio para estar entre os top 2 players no território do banho (capilar, Garantir a execução disciplinada de lançamentos: desde validação de Grid até acompanhamento de execução \nSer e parecer (inovação, qualidade): qualidade como “básico inegociável” e desenvolver embalagens, formulação, claims, alinhados com a proposta de valor da marca', x: 600, y: 13920, color: 'green' },
            { id: '5-1-5-k', type: 'kpi', label: 'Brand Power \nSell out – volume\nShare Valor/Share Volume\n% ROL Inovação\nDistribuição de inovação', x: 900, y: 13920, color: 'green' },
            { id: '5-1-6', type: 'action', label: 'Reconhecimento como a única marca do segmento de limpeza a estar no ranking de marcas mais valiosas do Brasil em 2025', description: '', x: 600, y: 14040, color: 'green' },
            { id: '5-2', type: 'attribute', label: 'Gestão de Crise', x: 300, y: 14300, color: 'green' },
            { id: '5-2-1', type: 'action', label: 'Relacionamento com cliente final e órgãos reguladores em situações de crise', description: '', x: 600, y: 14300, color: 'green' },
            { id: '5-3', type: 'attribute', label: 'Parcerias', x: 300, y: 14560, color: 'green' },
            { id: '5-3-1', type: 'action', label: 'Parcerias com outras marcas (exemplo Loccitane)', description: 'Posicionamento de marca', x: 600, y: 14560, color: 'green' },
            { id: '5-4', type: 'attribute', label: 'cascatear estratégia', x: 300, y: 14820, color: 'green' },
            { id: '5-4-1', type: 'action', label: 'Informar e engajar', description: 'Convenção líderes / Reuniões de cascateamento da estratégia por departamento / Reunião trimestral de resultados / Rituais de SEY de acompanhamento das metas operacionais / Comunicação interna sobre o alcance das metas / PPR para reconhecimento do alcance das metas', x: 600, y: 14820, color: 'green' },
            { id: '6', type: 'dimension', label: 'Produzir', x: 0, y: 16320, color: 'slate' },
            { id: '6-1', type: 'attribute', label: 'Produtividade', x: 300, y: 15340, color: 'slate' },
            { id: '6-1-1', type: 'action', label: 'Oportunidades de redução / simplificação', description: 'Máquina Comercial e de execução\n\nEvoluir a gestão de vendas, trade e logística para atingir novos patamares \n• Rever, simplificar, desburocratizar e automatizar processos comerciais\n • Adotar tecnologia como alavanca em prol do negócio \n• Avaliar requisitos e assegurar os ajustes necessários para que o time seja capaz de executar eficientemente a nova realidade e complexidade da \n• Desenvolver o profissional de vendas e merchandising para os novos desafios\nNa manutenção, há manutenção aditiva, com a existência de inteligência de peças de reposição com objetivo redução de custos. \nGestão matricial de manutenção e industrial, com diretrizes centralizadas e execução realizada diretamente pelas unidades locais (tanto para produção, quanto para manutenção).', x: 600, y: 15340, color: 'slate' },
            { id: '6-1-1-k', type: 'kpi', label: 'Volume Sell Out\nYperexecução\nOTIF\nAdvantage\nMargem de Servir\nProdutividade de Vendas\nProdutividade Promotores', x: 900, y: 15340, color: 'slate' },
            { id: '6-1-2', type: 'action', label: 'Aumento de lucratividade', description: 'Produção e logística são nosso motor\n\nAssegurar cadeia responsiva e flexível como diferencial competitivo \n• Assegurar que o nosso parque industrial/CD seja flexível, resiliente e próximo do mercado; \n• Garantir que infra/capacidade estejam alinhadas às diretrizes de categorias; \n• Flexibilidade para empurrar crescimento (make/borrow/buy); \n• Consolidar um IBP eficaz, sincronizando áreas e premissas para maximizar OTIF, Presença no PDV e EBITDA; \n• Assegurar qualidade de ponta a ponta: fazer certo da primeira vez;\n • Ganhar produtividade', x: 600, y: 15460, color: 'slate' },
            { id: '6-1-2-k', type: 'kpi', label: 'Frete de distribuição\nFrete de transferência\nOTIF\nRuptura em Gondola\nCusto variável/ROL (garantir nas atividades custo de \ninsumos/custo de aquisição)\nCustos de CDs\nAdvantage\nMaturidade do ciclo IBP\nOEE\nGGF\nAcuracidade de demanda SKU/CD', x: 900, y: 15460, color: 'slate' },
            { id: '6-2', type: 'attribute', label: 'Automatização', x: 300, y: 15720, color: 'slate' },
            { id: '6-2-1', type: 'action', label: 'Automatização de backoffice para ganho de produtividade', description: 'Revisar processos e aplicar tecnologia como alavanca de produtividade no backoffice \n• Evoluir a utilização de dados como força motriz \n• Rever, simplificar, desburocratizar e automatizar processos internos \n• Adotar tecnologia como alavanca em prol do negócio \n• Avaliar requisitos e assegurar os ajustes necessários para que o time seja capaz de executar eficientemente a nova realidade e complexidade da companhia \n• Reforçar a mentalidade de total experience', x: 600, y: 15720, color: 'slate' },
            { id: '6-2-1-k', type: 'kpi', label: '% R$ Pacote Gente Backoffice/ ROL', x: 900, y: 15720, color: 'slate' },
            { id: '6-3', type: 'attribute', label: 'Produto (manufatura)', x: 300, y: 15980, color: 'slate' },
            { id: '6-3-1', type: 'action', label: 'Confiabilidade de ativos', description: 'Software e sensores de controle preditivo, Análise de tendências , Paradas programadas\nGovernança e estratégia - matricial\nOperacionalização - local, nas plantas', x: 600, y: 15980, color: 'slate' },
            { id: '6-4', type: 'attribute', label: 'Auditorias', x: 300, y: 16240, color: 'slate' },
            { id: '6-4-1', type: 'action', label: 'TPM', description: 'Auditorias de Saúde do sistema e análise de evolução de passos (anuais) em todas as frentes', x: 600, y: 16240, color: 'slate' },
            { id: '6-5', type: 'attribute', label: 'Negócio', x: 300, y: 16500, color: 'slate' },
            { id: '6-5-1', type: 'action', label: 'Ecossistema de Aprendizagem e Hubs (Liderança, Estratégico, Backoffice, Comercial e Operações)', description: '', x: 600, y: 16500, color: 'slate' },
            { id: '6-5-2', type: 'action', label: 'Dia Y', description: '', x: 600, y: 16620, color: 'slate' },
            { id: '6-5-3', type: 'action', label: 'Academia de Key Users', description: '', x: 600, y: 16740, color: 'slate' },
            { id: '6-6', type: 'attribute', label: 'Operações', x: 300, y: 17000, color: 'slate' },
            { id: '6-6-1', type: 'action', label: 'Aprendizagem Técnica', description: 'CID - Política, procedimentos (IOP)', x: 600, y: 17000, color: 'slate' },
            { id: '6-6-2', type: 'action', label: 'Aprendizagem Técnica', description: 'PROTEC (Programa de Desenvolvimento Técnico e Certificação Ypê) / Multiplicadores / Bolsas de Estudo', x: 600, y: 17120, color: 'slate' },
            { id: '6-6-3', type: 'action', label: 'Aprendizagem Técnica', description: 'Programa de Aprendiz Técnico (curso de Eletromecânica e Auxiliar de produção)', x: 600, y: 17240, color: 'slate' },
            { id: '6-6-4', type: 'action', label: 'Aprendizagem Técnica', description: 'Academia de Manutenção SENAI', x: 600, y: 17360, color: 'slate' },
            { id: '7', type: 'dimension', label: 'Aprender (será que é só UnYpê mesmo?)', x: 0, y: 18550, color: 'orange' },
            { id: '7-1', type: 'attribute', label: 'Operações', x: 300, y: 17880, color: 'orange' },
            { id: '7-1-1', type: 'action', label: 'TPM', description: 'Simulador de aprendizagem / desenho LUP / Matriz de Habilidade / Da minha máquina cuido eu (conservação autônoma) / Gestão de conhecimento de processos chave / /Árvore de Perdas', x: 600, y: 17880, color: 'orange' },
            { id: '7-1-2', type: 'action', label: 'Aprendizagem técnica', description: 'Formção de Green Belt', x: 600, y: 18000, color: 'orange' },
            { id: '7-1-3', type: 'action', label: 'UnYpê', description: 'Piluas de conhecimento (UnypÊ)', x: 600, y: 18120, color: 'orange' },
            { id: '7-2', type: 'attribute', label: 'Comercial', x: 300, y: 18380, color: 'orange' },
            { id: '7-2-1', type: 'action', label: 'Aprendizagem comercial', description: 'Imersão em Vendas', x: 600, y: 18380, color: 'orange' },
            { id: '7-3', type: 'attribute', label: 'Liderança', x: 300, y: 18640, color: 'orange' },
            { id: '7-3-1', type: 'action', label: 'Academia dos líderes', description: '', x: 600, y: 18640, color: 'orange' },
            { id: '7-4', type: 'attribute', label: 'Upskilling e Reskilling', x: 300, y: 18900, color: 'orange' },
            { id: '7-4-1', type: 'action', label: 'Interno', description: 'Ypê Talks', x: 600, y: 18900, color: 'orange' },
            { id: '7-4-2', type: 'action', label: 'Externo', description: 'Único Skill (formação continuada para colaboradores)', x: 600, y: 19020, color: 'orange' },
            { id: '7-5', type: 'attribute', label: 'Experiência do colaborador', x: 300, y: 19280, color: 'orange' },
            { id: '7-5-1', type: 'action', label: 'Onboarding', description: '', x: 600, y: 19280, color: 'orange' },
            { id: '8', type: 'dimension', label: 'Comunicar', x: 0, y: 19960, color: 'teal' },
            { id: '8-1', type: 'attribute', label: 'Colaboradores', x: 300, y: 19800, color: 'teal' },
            { id: '8-1-1', type: 'action', label: 'Canais, tom de voz, narrativa, deck de mensagens, preparação da liderança', description: '', x: 600, y: 19800, color: 'teal' },
            { id: '8-2', type: 'attribute', label: 'Mercado', x: 300, y: 20060, color: 'teal' },
            { id: '8-2-1', type: 'action', label: 'Programa de Embaixadores', description: '', x: 600, y: 20060, color: 'teal' },
            { id: '8-2-2', type: 'action', label: 'Programa de Marca Empregadora', description: '', x: 600, y: 20180, color: 'teal' },
            { id: '8-2-2-k', type: 'kpi', label: '% Retenção talentos', x: 900, y: 20180, color: 'teal' },
            { id: '9', type: 'dimension', label: 'Desenvolver', x: 0, y: 21220, color: 'indigo' },
            { id: '9-1', type: 'attribute', label: 'Habilidades Internas', x: 300, y: 20700, color: 'indigo' },
            { id: '9-1-1', type: 'action', label: 'Preparação para líderes', description: 'Talentos (Coordenadores) / Programa de Desenvolvimento de Talentos Supervisores', x: 600, y: 20700, color: 'indigo' },
            { id: '9-1-2', type: 'action', label: 'Unypê', description: 'Educar Y - Programa para educar colaboradores no ensino fundamental e médio', x: 600, y: 20820, color: 'indigo' },
            { id: '9-1-3', type: 'action', label: 'Ciclo de Gente', description: 'Performance, feedback, metas individuais', x: 600, y: 20940, color: 'indigo' },
            { id: '9-1-4', type: 'action', label: 'Novos talentos', description: 'Programa de Estágio', x: 600, y: 21060, color: 'indigo' },
            { id: '9-1-5', type: 'action', label: 'Desenvolvimento Tecnico', description: 'PROTEC (Programa de Desenvolvimento Técnico e Certificação Ypê)', x: 600, y: 21180, color: 'indigo' },
            { id: '9-2', type: 'attribute', label: 'Colaboradores', x: 300, y: 21440, color: 'indigo' },
            { id: '9-2-1', type: 'action', label: 'Reconhecimento', description: '(Programa Cultivar) Atitude, Gratidão, Projetos Destaque e Ydealize', x: 600, y: 21440, color: 'indigo' },
            { id: '9-2-2', type: 'action', label: 'Reconhecimento', description: 'Mérito de acordo com avaliação de performance', x: 600, y: 21560, color: 'indigo' },
            { id: '9-2-3', type: 'action', label: 'Reconhecimento', description: 'Promoção e Comitê de Carreira para coordenadores', x: 600, y: 21680, color: 'indigo' },
            { id: '9-2-4', type: 'action', label: 'Reconhecimento', description: 'TPM - Reconhecimento para Melhorias Específicas', x: 600, y: 21800, color: 'indigo' },
            { id: '10', type: 'dimension', label: 'Projetizar', x: 0, y: 22420, color: 'rose' },
            { id: '10-1', type: 'attribute', label: 'Escritório de VMO (Value Management Office)', x: 300, y: 22320, color: 'rose' },
            { id: '10-1-1', type: 'action', label: 'Gestão de protfólio de oficinas por temas mapeados', description: 'Acompanhamento de novas ideias, gardrails por tema, governança das ideias por meio da criação do RG (como um business case), aprovação e definição de recursos financeiros e pessoas / implementação e acompanhamento (feito diretamente pela oficina responsável).\nMetologia majoritaria: Ágil, com exceções Waterfall. Todas as oficinas partem da premissa da multidisciplinaridade, com mapeamento de pessoas chave por tema (para além da área "dona" do tema", com visão E2E.', x: 600, y: 22320, color: 'rose' },
            { id: '10-2', type: 'attribute', label: 'Recursos Financeiros', x: 300, y: 22580, color: 'rose' },
            { id: '10-2-1', type: 'action', label: 'Gestão de recursos sob engenharia ( e VMO com Fábia)', description: 'Alocação de recursos feita centralizada, feita pela engenharia)', x: 600, y: 22580, color: 'rose' },
            { id: '11', type: 'dimension', label: 'Compartilhar?', x: 0, y: 23570, color: 'cyan' },
            { id: '11-1', type: 'attribute', label: 'Comunicação Interna', x: 300, y: 23100, color: 'cyan' },
            { id: '11-1-1', type: 'action', label: 'Vivência da Estratégia', description: 'Convenção líderes / Reuniões de cascateamento da estratégia por departamento / Reunião trimestral de resultados / Rituais de SEY de acompanhamento das metas operacionais / Comunicação interna sobre o alcance das metas / PPR para reconhecimento do alcance das metas', x: 600, y: 23100, color: 'cyan' },
            { id: '11-1-2', type: 'action', label: 'Comunicação Interna Formal', description: 'Canais de comunicação interna', x: 600, y: 23220, color: 'cyan' },
            { id: '11-1-3', type: 'action', label: 'Entre times', description: 'Governana do TPM por meio de gestão visual em trocas de turnos e reuniões de acompanhamento por tier.', x: 600, y: 23340, color: 'cyan' },
            { id: '11-2', type: 'attribute', label: 'Comunicação Externa', x: 300, y: 23600, color: 'cyan' },
            { id: '11-2-1', type: 'action', label: 'Marca Empregadora', description: 'GPTW e projeto de desenvolvimento da marca empregadora em 2026, linkedin (completar)', x: 600, y: 23600, color: 'cyan' },
            { id: '11-2-2', type: 'action', label: 'Comunicação Imprensa', description: 'Site, releases (completar)', x: 600, y: 23720, color: 'cyan' },
            { id: '11-2-3', type: 'action', label: 'Comunicação Digital', description: 'Linkedin, Instagram, redes sociais (completar)', x: 600, y: 23840, color: 'cyan' },
            { id: '11-3', type: 'attribute', label: 'Gestão de Conhecimento', x: 300, y: 24100, color: 'cyan' },
            { id: '11-3-1', type: 'action', label: 'Entre times', description: 'Matriz de Habilidade (TPM)', x: 600, y: 24100, color: 'cyan' },
            { id: '12', type: 'dimension', label: 'Atrair?', x: 0, y: 24590, color: 'stone' },
            { id: '12-1', type: 'attribute', label: '?', x: 300, y: 24620, color: 'stone' },
            { id: '12-1-1', type: 'action', label: '?', description: 'Programa de Estágio', x: 600, y: 24620, color: 'stone' },
            { id: '13', type: 'dimension', label: 'Servir', x: 0, y: 25110, color: 'lime' },
            { id: '13-1', type: 'attribute', label: 'à filantropia', x: 300, y: 25140, color: 'lime' },
            { id: '13-1-1', type: 'action', label: 'Instituto da Família (ainda em processo)', description: 'Natal / Você e a Paz / Ações promovidas pela família', x: 600, y: 25140, color: 'lime' },
        ];

        const INITIAL_EDGES_DATA = [
            { id: 'e1-1-1', source: '1', target: '1-1' },
            { id: 'e1-1-1-1-1', source: '1-1', target: '1-1-1' },
            { id: 'e1-1-1-k', source: '1-1-1', target: '1-1-1-k' },
            { id: 'e1-1-1-1-2', source: '1-1', target: '1-1-2' },
            { id: 'e1-1-2-k', source: '1-1-2', target: '1-1-2-k' },
            { id: 'e1-1-1-1-3', source: '1-1', target: '1-1-3' },
            { id: 'e1-1-1-1-4', source: '1-1', target: '1-1-4' },
            { id: 'e1-1-2', source: '1', target: '1-2' },
            { id: 'e1-2-1-2-1', source: '1-2', target: '1-2-1' },
            { id: 'e1-2-1-k', source: '1-2-1', target: '1-2-1-k' },
            { id: 'e1-2-1-2-2', source: '1-2', target: '1-2-2' },
            { id: 'e1-2-2-k', source: '1-2-2', target: '1-2-2-k' },
            { id: 'e1-2-1-2-3', source: '1-2', target: '1-2-3' },
            { id: 'e1-2-1-2-4', source: '1-2', target: '1-2-4' },
            { id: 'e1-2-1-2-5', source: '1-2', target: '1-2-5' },
            { id: 'e1-2-5-k', source: '1-2-5', target: '1-2-5-k' },
            { id: 'e1-2-1-2-6', source: '1-2', target: '1-2-6' },
            { id: 'e2-2-1', source: '2', target: '2-1' },
            { id: 'e2-1-2-1-1', source: '2-1', target: '2-1-1' },
            { id: 'e2-1-1-k', source: '2-1-1', target: '2-1-1-k' },
            { id: 'e2-1-2-1-2', source: '2-1', target: '2-1-2' },
            { id: 'e2-1-2-1-3', source: '2-1', target: '2-1-3' },
            { id: 'e2-2-2', source: '2', target: '2-2' },
            { id: 'e2-2-2-2-1', source: '2-2', target: '2-2-1' },
            { id: 'e2-2-2-2-2', source: '2-2', target: '2-2-2' },
            { id: 'e2-2-2-2-3', source: '2-2', target: '2-2-3' },
            { id: 'e2-2-3-k', source: '2-2-3', target: '2-2-3-k' },
            { id: 'e2-2-2-2-4', source: '2-2', target: '2-2-4' },
            { id: 'e2-2-2-2-5', source: '2-2', target: '2-2-5' },
            { id: 'e2-2-2-2-6', source: '2-2', target: '2-2-6' },
            { id: 'e2-2-2-2-7', source: '2-2', target: '2-2-7' },
            { id: 'e2-2-2-2-8', source: '2-2', target: '2-2-8' },
            { id: 'e2-2-2-2-9', source: '2-2', target: '2-2-9' },
            { id: 'e2-2-2-2-10', source: '2-2', target: '2-2-10' },
            { id: 'e2-2-2-2-11', source: '2-2', target: '2-2-11' },
            { id: 'e2-2-2-2-12', source: '2-2', target: '2-2-12' },
            { id: 'e2-2-2-2-13', source: '2-2', target: '2-2-13' },
            { id: 'e2-2-2-2-14', source: '2-2', target: '2-2-14' },
            { id: 'e2-2-2-2-15', source: '2-2', target: '2-2-15' },
            { id: 'e2-2-2-2-16', source: '2-2', target: '2-2-16' },
            { id: 'e2-2-2-2-17', source: '2-2', target: '2-2-17' },
            { id: 'e2-2-17-k', source: '2-2-17', target: '2-2-17-k' },
            { id: 'e2-2-2-2-18', source: '2-2', target: '2-2-18' },
            { id: 'e2-2-2-2-19', source: '2-2', target: '2-2-19' },
            { id: 'e2-2-19-k', source: '2-2-19', target: '2-2-19-k' },
            { id: 'e2-2-2-2-20', source: '2-2', target: '2-2-20' },
            { id: 'e2-2-20-k', source: '2-2-20', target: '2-2-20-k' },
            { id: 'e2-2-2-2-21', source: '2-2', target: '2-2-21' },
            { id: 'e2-2-2-2-22', source: '2-2', target: '2-2-22' },
            { id: 'e2-2-2-2-23', source: '2-2', target: '2-2-23' },
            { id: 'e2-2-2-2-24', source: '2-2', target: '2-2-24' },
            { id: 'e2-2-3', source: '2', target: '2-3' },
            { id: 'e2-3-2-3-1', source: '2-3', target: '2-3-1' },
            { id: 'e2-3-1-k', source: '2-3-1', target: '2-3-1-k' },
            { id: 'e2-2-4', source: '2', target: '2-4' },
            { id: 'e2-4-2-4-1', source: '2-4', target: '2-4-1' },
            { id: 'e2-4-2-4-2', source: '2-4', target: '2-4-2' },
            { id: 'e2-4-2-k', source: '2-4-2', target: '2-4-2-k' },
            { id: 'e2-2-5', source: '2', target: '2-5' },
            { id: 'e2-5-2-5-1', source: '2-5', target: '2-5-1' },
            { id: 'e2-5-1-k', source: '2-5-1', target: '2-5-1-k' },
            { id: 'e3-3-1', source: '3', target: '3-1' },
            { id: 'e3-1-3-1-1', source: '3-1', target: '3-1-1' },
            { id: 'e3-1-1-k', source: '3-1-1', target: '3-1-1-k' },
            { id: 'e3-1-3-1-2', source: '3-1', target: '3-1-2' },
            { id: 'e3-1-3-1-3', source: '3-1', target: '3-1-3' },
            { id: 'e3-1-3-1-4', source: '3-1', target: '3-1-4' },
            { id: 'e3-1-3-1-5', source: '3-1', target: '3-1-5' },
            { id: 'e3-1-3-1-6', source: '3-1', target: '3-1-6' },
            { id: 'e3-1-3-1-7', source: '3-1', target: '3-1-7' },
            { id: 'e3-1-7-k', source: '3-1-7', target: '3-1-7-k' },
            { id: 'e3-1-3-1-8', source: '3-1', target: '3-1-8' },
            { id: 'e3-1-8-k', source: '3-1-8', target: '3-1-8-k' },
            { id: 'e3-3-2', source: '3', target: '3-2' },
            { id: 'e3-2-3-2-1', source: '3-2', target: '3-2-1' },
            { id: 'e3-2-1-k', source: '3-2-1', target: '3-2-1-k' },
            { id: 'e3-2-3-2-2', source: '3-2', target: '3-2-2' },
            { id: 'e3-2-3-2-3', source: '3-2', target: '3-2-3' },
            { id: 'e3-2-3-2-4', source: '3-2', target: '3-2-4' },
            { id: 'e3-2-3-2-5', source: '3-2', target: '3-2-5' },
            { id: 'e3-3-3', source: '3', target: '3-3' },
            { id: 'e3-3-3-3-1', source: '3-3', target: '3-3-1' },
            { id: 'e3-3-3-3-2', source: '3-3', target: '3-3-2' },
            { id: 'e3-3-4', source: '3', target: '3-4' },
            { id: 'e3-4-3-4-1', source: '3-4', target: '3-4-1' },
            { id: 'e3-4-3-4-2', source: '3-4', target: '3-4-2' },
            { id: 'e3-4-3-4-3', source: '3-4', target: '3-4-3' },
            { id: 'e4-4-1', source: '4', target: '4-1' },
            { id: 'e4-1-4-1-1', source: '4-1', target: '4-1-1' },
            { id: 'e4-1-4-1-2', source: '4-1', target: '4-1-2' },
            { id: 'e4-1-4-1-3', source: '4-1', target: '4-1-3' },
            { id: 'e4-1-4-1-4', source: '4-1', target: '4-1-4' },
            { id: 'e4-1-4-1-5', source: '4-1', target: '4-1-5' },
            { id: 'e4-4-2', source: '4', target: '4-2' },
            { id: 'e4-2-4-2-1', source: '4-2', target: '4-2-1' },
            { id: 'e4-2-1-k', source: '4-2-1', target: '4-2-1-k' },
            { id: 'e4-2-4-2-2', source: '4-2', target: '4-2-2' },
            { id: 'e4-4-3', source: '4', target: '4-3' },
            { id: 'e4-3-4-3-1', source: '4-3', target: '4-3-1' },
            { id: 'e4-3-4-3-2', source: '4-3', target: '4-3-2' },
            { id: 'e4-3-4-3-3', source: '4-3', target: '4-3-3' },
            { id: 'e4-3-4-3-4', source: '4-3', target: '4-3-4' },
            { id: 'e4-3-4-3-5', source: '4-3', target: '4-3-5' },
            { id: 'e4-3-4-3-6', source: '4-3', target: '4-3-6' },
            { id: 'e4-3-4-3-7', source: '4-3', target: '4-3-7' },
            { id: 'e4-3-4-3-8', source: '4-3', target: '4-3-8' },
            { id: 'e4-3-4-3-9', source: '4-3', target: '4-3-9' },
            { id: 'e4-3-4-3-10', source: '4-3', target: '4-3-10' },
            { id: 'e4-3-4-3-11', source: '4-3', target: '4-3-11' },
            { id: 'e4-3-4-3-12', source: '4-3', target: '4-3-12' },
            { id: 'e4-4-4', source: '4', target: '4-4' },
            { id: 'e4-4-4-4-1', source: '4-4', target: '4-4-1' },
            { id: 'e4-4-4-4-2', source: '4-4', target: '4-4-2' },
            { id: 'e4-4-5', source: '4', target: '4-5' },
            { id: 'e4-5-4-5-1', source: '4-5', target: '4-5-1' },
            { id: 'e4-5-4-5-2', source: '4-5', target: '4-5-2' },
            { id: 'e4-5-4-5-3', source: '4-5', target: '4-5-3' },
            { id: 'e5-5-1', source: '5', target: '5-1' },
            { id: 'e5-1-5-1-1', source: '5-1', target: '5-1-1' },
            { id: 'e5-1-1-k', source: '5-1-1', target: '5-1-1-k' },
            { id: 'e5-1-5-1-2', source: '5-1', target: '5-1-2' },
            { id: 'e5-1-5-1-3', source: '5-1', target: '5-1-3' },
            { id: 'e5-1-5-1-4', source: '5-1', target: '5-1-4' },
            { id: 'e5-1-4-k', source: '5-1-4', target: '5-1-4-k' },
            { id: 'e5-1-5-1-5', source: '5-1', target: '5-1-5' },
            { id: 'e5-1-5-k', source: '5-1-5', target: '5-1-5-k' },
            { id: 'e5-1-5-1-6', source: '5-1', target: '5-1-6' },
            { id: 'e5-5-2', source: '5', target: '5-2' },
            { id: 'e5-2-5-2-1', source: '5-2', target: '5-2-1' },
            { id: 'e5-5-3', source: '5', target: '5-3' },
            { id: 'e5-3-5-3-1', source: '5-3', target: '5-3-1' },
            { id: 'e5-5-4', source: '5', target: '5-4' },
            { id: 'e5-4-5-4-1', source: '5-4', target: '5-4-1' },
            { id: 'e6-6-1', source: '6', target: '6-1' },
            { id: 'e6-1-6-1-1', source: '6-1', target: '6-1-1' },
            { id: 'e6-1-1-k', source: '6-1-1', target: '6-1-1-k' },
            { id: 'e6-1-6-1-2', source: '6-1', target: '6-1-2' },
            { id: 'e6-1-2-k', source: '6-1-2', target: '6-1-2-k' },
            { id: 'e6-6-2', source: '6', target: '6-2' },
            { id: 'e6-2-6-2-1', source: '6-2', target: '6-2-1' },
            { id: 'e6-2-1-k', source: '6-2-1', target: '6-2-1-k' },
            { id: 'e6-6-3', source: '6', target: '6-3' },
            { id: 'e6-3-6-3-1', source: '6-3', target: '6-3-1' },
            { id: 'e6-6-4', source: '6', target: '6-4' },
            { id: 'e6-4-6-4-1', source: '6-4', target: '6-4-1' },
            { id: 'e6-6-5', source: '6', target: '6-5' },
            { id: 'e6-5-6-5-1', source: '6-5', target: '6-5-1' },
            { id: 'e6-5-6-5-2', source: '6-5', target: '6-5-2' },
            { id: 'e6-5-6-5-3', source: '6-5', target: '6-5-3' },
            { id: 'e6-6-6', source: '6', target: '6-6' },
            { id: 'e6-6-6-6-1', source: '6-6', target: '6-6-1' },
            { id: 'e6-6-6-6-2', source: '6-6', target: '6-6-2' },
            { id: 'e6-6-6-6-3', source: '6-6', target: '6-6-3' },
            { id: 'e6-6-6-6-4', source: '6-6', target: '6-6-4' },
            { id: 'e7-7-1', source: '7', target: '7-1' },
            { id: 'e7-1-7-1-1', source: '7-1', target: '7-1-1' },
            { id: 'e7-1-7-1-2', source: '7-1', target: '7-1-2' },
            { id: 'e7-1-7-1-3', source: '7-1', target: '7-1-3' },
            { id: 'e7-7-2', source: '7', target: '7-2' },
            { id: 'e7-2-7-2-1', source: '7-2', target: '7-2-1' },
            { id: 'e7-7-3', source: '7', target: '7-3' },
            { id: 'e7-3-7-3-1', source: '7-3', target: '7-3-1' },
            { id: 'e7-7-4', source: '7', target: '7-4' },
            { id: 'e7-4-7-4-1', source: '7-4', target: '7-4-1' },
            { id: 'e7-4-7-4-2', source: '7-4', target: '7-4-2' },
            { id: 'e7-7-5', source: '7', target: '7-5' },
            { id: 'e7-5-7-5-1', source: '7-5', target: '7-5-1' },
            { id: 'e8-8-1', source: '8', target: '8-1' },
            { id: 'e8-1-8-1-1', source: '8-1', target: '8-1-1' },
            { id: 'e8-8-2', source: '8', target: '8-2' },
            { id: 'e8-2-8-2-1', source: '8-2', target: '8-2-1' },
            { id: 'e8-2-8-2-2', source: '8-2', target: '8-2-2' },
            { id: 'e8-2-2-k', source: '8-2-2', target: '8-2-2-k' },
            { id: 'e9-9-1', source: '9', target: '9-1' },
            { id: 'e9-1-9-1-1', source: '9-1', target: '9-1-1' },
            { id: 'e9-1-9-1-2', source: '9-1', target: '9-1-2' },
            { id: 'e9-1-9-1-3', source: '9-1', target: '9-1-3' },
            { id: 'e9-1-9-1-4', source: '9-1', target: '9-1-4' },
            { id: 'e9-1-9-1-5', source: '9-1', target: '9-1-5' },
            { id: 'e9-9-2', source: '9', target: '9-2' },
            { id: 'e9-2-9-2-1', source: '9-2', target: '9-2-1' },
            { id: 'e9-2-9-2-2', source: '9-2', target: '9-2-2' },
            { id: 'e9-2-9-2-3', source: '9-2', target: '9-2-3' },
            { id: 'e9-2-9-2-4', source: '9-2', target: '9-2-4' },
            { id: 'e10-10-1', source: '10', target: '10-1' },
            { id: 'e10-1-10-1-1', source: '10-1', target: '10-1-1' },
            { id: 'e10-10-2', source: '10', target: '10-2' },
            { id: 'e10-2-10-2-1', source: '10-2', target: '10-2-1' },
            { id: 'e11-11-1', source: '11', target: '11-1' },
            { id: 'e11-1-11-1-1', source: '11-1', target: '11-1-1' },
            { id: 'e11-1-11-1-2', source: '11-1', target: '11-1-2' },
            { id: 'e11-1-11-1-3', source: '11-1', target: '11-1-3' },
            { id: 'e11-11-2', source: '11', target: '11-2' },
            { id: 'e11-2-11-2-1', source: '11-2', target: '11-2-1' },
            { id: 'e11-2-11-2-2', source: '11-2', target: '11-2-2' },
            { id: 'e11-2-11-2-3', source: '11-2', target: '11-2-3' },
            { id: 'e11-11-3', source: '11', target: '11-3' },
            { id: 'e11-3-11-3-1', source: '11-3', target: '11-3-1' },
            { id: 'e12-12-1', source: '12', target: '12-1' },
            { id: 'e12-1-12-1-1', source: '12-1', target: '12-1-1' },
            { id: 'e13-13-1', source: '13', target: '13-1' },
            { id: 'e13-1-13-1-1', source: '13-1', target: '13-1-1' },
        ];

        function App() {
            // Estado local inicializado com dados vazios para evitar erro antes do sync
            const [nodes, setNodes] = useState([]);
            const [edges, setEdges] = useState([]);
            const [selectedNodeId, setSelectedNodeId] = useState(null);
            const [isSyncing, setIsSyncing] = useState(true);
            
            // Viewport
            const [scale, setScale] = useState(0.5); 
            const [pan, setPan] = useState({ x: 50, y: 50 });
            
            // Interação
            const [isDraggingNode, setIsDraggingNode] = useState(null);
            const [isPanning, setIsPanning] = useState(false);
            const [lastMousePos, setLastMousePos] = useState({ x: 0, y: 0 });

            const containerRef = useRef(null);

            // --- FIREBASE SYNC ---
            useEffect(() => {
                const initSync = async () => {
                    if (!window.firebaseDB) {
                        // Aguarda evento de carregamento se o script ainda não rodou
                        window.addEventListener('firebase-ready', initSync);
                        return;
                    }

                    const db = window.firebaseDB;
                    const docRef = window.firebaseDoc(db, "maps", "ype_v1");

                    // Listener em tempo real
                    const unsubscribe = window.firebaseOnSnapshot(docRef, async (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            // Se não estamos arrastando (para evitar conflito de UI), atualiza
                            if (!isDraggingNode) {
                                setNodes(data.nodes || []);
                                setEdges(data.edges || []);
                            }
                        } else {
                            // Se documento não existe, cria com o SEED
                            await window.firebaseSetDoc(docRef, {
                                nodes: INITIAL_NODES_DATA,
                                edges: INITIAL_EDGES_DATA
                            });
                        }
                        setIsSyncing(false);
                    });

                    return unsubscribe;
                };

                initSync();
            }, []);

            // Função para salvar no Firebase
            const saveToCloud = useCallback(async (newNodes, newEdges) => {
                if (!window.firebaseDB) return;
                const db = window.firebaseDB;
                const docRef = window.firebaseDoc(db, "maps", "ype_v1");
                
                try {
                    await window.firebaseSetDoc(docRef, {
                        nodes: newNodes,
                        edges: newEdges
                    }, { merge: true });
                } catch (e) {
                    console.error("Erro ao salvar:", e);
                }
            }, []);


            // --- Handlers de Mouse ---
            const handleMouseDown = (e) => {
                if (e.target.closest('button') || e.target.closest('input') || e.target.closest('textarea') || e.target.closest('select')) return;

                const nodeElement = e.target.closest('[data-nodeid]');

                if (nodeElement) {
                    const nodeId = nodeElement.dataset.nodeid;
                    setIsDraggingNode(nodeId);
                    setLastMousePos({ x: e.clientX, y: e.clientY });
                    setSelectedNodeId(nodeId);
                    e.stopPropagation();
                } else {
                    setIsPanning(true);
                    setLastMousePos({ x: e.clientX, y: e.clientY });
                    setSelectedNodeId(null);
                }
            };

            const handleMouseMove = useCallback((e) => {
                const deltaX = e.clientX - lastMousePos.x;
                const deltaY = e.clientY - lastMousePos.y;

                if (isDraggingNode) {
                    const newNodes = nodes.map(node => {
                        if (node.id === isDraggingNode) {
                            return {
                                ...node,
                                x: node.x + deltaX / scale,
                                y: node.y + deltaY / scale
                            };
                        }
                        return node;
                    });
                    setNodes(newNodes);
                    setLastMousePos({ x: e.clientX, y: e.clientY });
                } else if (isPanning) {
                    setPan((prev) => ({
                        x: prev.x + deltaX,
                        y: prev.y + deltaY
                    }));
                    setLastMousePos({ x: e.clientX, y: e.clientY });
                }
            }, [isDraggingNode, isPanning, lastMousePos, scale, nodes]);

            const handleMouseUp = () => {
                if (isDraggingNode) {
                    saveToCloud(nodes, edges); // Salva ao soltar
                }
                setIsDraggingNode(null);
                setIsPanning(false);
            };

            // --- CRUD ---
            
            const handleUpdateNode = (id, field, value) => {
                const newNodes = nodes.map(n => n.id === id ? { ...n, [field]: value } : n);
                setNodes(newNodes);
                saveToCloud(newNodes, edges);
            };

            const getParentId = (childId) => {
                const edge = edges.find(e => e.target === childId);
                return edge ? edge.source : '';
            };

            const handleRelinkNode = (childId, newParentId) => {
                if (!newParentId) return;

                const newParentNode = nodes.find(n => n.id === newParentId);
                const childNode = nodes.find(n => n.id === childId);

                const newEdges = edges.filter(e => e.target !== childId);
                newEdges.push({ id: `e${newParentId}-${childId}-${Date.now()}`, source: newParentId, target: childId });
                
                let newNodes = nodes;
                if (newParentNode && childNode) {
                    newNodes = nodes.map(n => n.id === childId ? {
                        ...n,
                        x: newParentNode.x + 250,
                        y: newParentNode.y + 20,
                        color: newParentNode.color
                    } : n);
                }
                
                setNodes(newNodes);
                setEdges(newEdges);
                saveToCloud(newNodes, newEdges);
            };

            const handleAddNode = (type) => {
                const parentId = selectedNodeId;
                const parentNode = nodes.find(n => n.id === parentId);
                
                const newNodeId = Date.now().toString();
                
                let startX = parentNode ? parentNode.x + 280 : (-pan.x + 100 + Math.random() * 50) / scale;
                let startY = parentNode ? parentNode.y : (-pan.y + 100 + Math.random() * 50) / scale;

                if (type === 'dimension' && !parentNode) {
                   const maxY = nodes.reduce((max, n) => Math.max(max, n.y), 0);
                   startY = maxY + 400;
                   startX = 0;
                }

                const newNode = {
                    id: newNodeId,
                    type: type,
                    label: type === 'dimension' ? 'Nova Dimensão' : type === 'attribute' ? 'Atributo' : type === 'action' ? 'Nova Ação' : 'Novo KPI',
                    description: '',
                    x: startX,
                    y: startY,
                    color: parentNode ? parentNode.color : 'blue'
                };

                const newNodes = [...nodes, newNode];
                let newEdges = edges;

                if (parentId) {
                    newEdges = [...edges, { id: `e${parentId}-${newNodeId}`, source: parentId, target: newNodeId }];
                }
                
                setNodes(newNodes);
                setEdges(newEdges);
                saveToCloud(newNodes, newEdges);
                setSelectedNodeId(newNodeId);
            };

            const handleDeleteNode = () => {
                if (!selectedNodeId) return;
                const newNodes = nodes.filter(n => n.id !== selectedNodeId);
                const newEdges = edges.filter(e => e.source !== selectedNodeId && e.target !== selectedNodeId);
                
                setNodes(newNodes);
                setEdges(newEdges);
                saveToCloud(newNodes, newEdges);
                setSelectedNodeId(null);
            };

            // --- Renderização Visual ---
            const getPath = (start, end) => {
                let startOffset = 220;
                if (start.type === 'dimension') startOffset = 150;
                if (start.type === 'attribute') startOffset = 180;
                if (start.type === 'action') startOffset = 230;
                if (start.type === 'kpi') startOffset = 180;

                const sx = start.x + startOffset; 
                const sy = start.y + 40; 
                const ex = end.x;
                const ey = end.y + 40;
                const control = Math.abs(ex - sx) * 0.4;

                return `M ${sx} ${sy} C ${sx + control} ${sy}, ${ex - control} ${ey}, ${ex} ${ey}`;
            };

            const selectedNode = nodes.find(n => n.id === selectedNodeId);
            
            const availableParents = nodes.filter(n => 
                n.id !== selectedNodeId && 
                n.type !== 'kpi' 
            );

            const renderNode = (node) => {
                const theme = THEMES[node.color] || THEMES.blue;
                const isSelected = selectedNodeId === node.id;
                const commonClasses = `absolute cursor-grab active:cursor-grabbing shadow-sm transition-all hover:shadow-md select-none group flex flex-col justify-center
                    ${isSelected ? 'ring-2 ring-offset-2 ring-slate-400 z-30' : 'z-10'}
                `;

                if (node.type === 'dimension') {
                    return (
                        <div
                            key={node.id}
                            data-nodeid={node.id}
                            className={`${commonClasses} w-[180px] h-[180px] rounded-full text-white items-center text-center p-4`}
                            style={{ left: node.x, top: node.y, backgroundColor: theme.main }}
                        >
                            <Icons.Target className="w-8 h-8 mb-2 opacity-90" />
                            <span className="font-bold text-xl leading-tight tracking-wider uppercase">{node.label}</span>
                        </div>
                    );
                }
                if (node.type === 'attribute') {
                    return (
                        <div
                            key={node.id}
                            data-nodeid={node.id}
                            className={`${commonClasses} w-[200px] min-h-[80px] bg-white rounded-2xl border-l-[8px] pl-4 pr-3 py-3`}
                            style={{ left: node.x, top: node.y, borderColor: theme.main }}
                        >
                            <div className="flex items-center gap-2 mb-1 opacity-60">
                                <Icons.Layers className="w-3 h-3" style={{ color: theme.main }} />
                                <span className="text-[10px] font-bold uppercase tracking-wider text-slate-500">Atributo</span>
                            </div>
                            <span className="font-bold text-lg text-slate-800 leading-snug">{node.label}</span>
                        </div>
                    );
                }
                if (node.type === 'action') {
                    return (
                        <div
                            key={node.id}
                            data-nodeid={node.id}
                            className={`${commonClasses} w-[240px] min-h-[90px] bg-white rounded-lg border border-slate-200 overflow-hidden`}
                            style={{ left: node.x, top: node.y }}
                        >
                            <div className="bg-slate-50 px-3 py-2 border-b border-slate-100 flex items-center gap-2">
                                <Icons.Play className="w-3 h-3" style={{ fill: theme.main, color: theme.main }} />
                                <span className="text-[10px] font-bold uppercase tracking-wider text-slate-500 truncate">{node.label}</span>
                            </div>
                            <div className="p-3">
                                <span className="font-medium text-xs text-slate-700 leading-relaxed block whitespace-pre-wrap">
                                    {node.description || "..."}
                                </span>
                            </div>
                        </div>
                    );
                }
                if (node.type === 'kpi') {
                    return (
                        <div
                            key={node.id}
                            data-nodeid={node.id}
                            className={`${commonClasses} w-[200px] min-h-[60px] bg-white rounded-lg border-2 border-dashed pl-3 pr-2 py-2`}
                            style={{ left: node.x, top: node.y, borderColor: theme.main, backgroundColor: theme.light }}
                        >
                            <div className="flex items-center gap-2 mb-1">
                                <Icons.BarChart3 className="w-3 h-3" style={{ color: theme.main }} />
                                <span className="text-[10px] font-bold uppercase tracking-wider" style={{ color: theme.main }}>KPI</span>
                            </div>
                            <span className="font-bold text-xs text-slate-800 leading-snug">{node.label}</span>
                        </div>
                    );
                }
            };

            if (isSyncing && nodes.length === 0) {
                return (
                    <div className="flex h-screen w-full items-center justify-center bg-slate-50 flex-col gap-4">
                        <div className="loader"></div>
                        <p className="text-slate-500 text-sm font-medium">Sincronizando com a Nuvem...</p>
                    </div>
                );
            }

            return (
                <div className="flex h-screen w-full bg-slate-50 overflow-hidden text-slate-800 font-sans">
                    
                    {/* --- Sidebar Fixa --- */}
                    <div className="w-80 bg-white border-r border-slate-200 shadow-xl z-50 flex flex-col shrink-0">
                        <div className="p-4 border-b border-slate-100 flex justify-between items-center">
                            <div>
                                <h1 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                                    <Icons.Layout className="w-5 h-5 text-blue-600" />
                                    Estratégia Ypê
                                </h1>
                                <p className="text-[10px] text-emerald-600 font-semibold flex items-center gap-1 mt-1">
                                    <Icons.CloudCheck className="w-3 h-3" /> Online & Sincronizado
                                </p>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 custom-scrollbar bg-slate-50/50">
                            {selectedNode ? (
                                <div className="space-y-4 animate-fadeIn">
                                    
                                    {/* Edição de Conteúdo */}
                                    <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm">
                                        <label className="block text-[10px] font-bold uppercase text-slate-400 mb-1">Título</label>
                                        <div className="flex items-center gap-2 pb-1">
                                            <Icons.Type className="w-4 h-4 text-slate-400" />
                                            <input 
                                                type="text"
                                                value={selectedNode.label} 
                                                onChange={(e) => handleUpdateNode(selectedNode.id, 'label', e.target.value)}
                                                className="w-full bg-transparent outline-none text-sm font-semibold text-slate-700 leading-snug"
                                            />
                                        </div>
                                        
                                        {selectedNode.type === 'action' && (
                                            <div className="mt-3 pt-3 border-t border-slate-100">
                                                <label className="block text-[10px] font-bold uppercase text-slate-400 mb-1">Detalhamento (Métodos)</label>
                                                <div className="flex gap-2">
                                                    <Icons.AlignLeft className="w-4 h-4 text-slate-400 mt-1" />
                                                    <textarea 
                                                        value={selectedNode.description} 
                                                        onChange={(e) => handleUpdateNode(selectedNode.id, 'description', e.target.value)}
                                                        className="w-full bg-transparent outline-none text-xs text-slate-600 resize-none h-24 leading-relaxed"
                                                    />
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Seção de Vínculo/Hierarquia */}
                                    {selectedNode.type !== 'dimension' && (
                                        <div className="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                            <label className="block text-[10px] font-bold uppercase text-blue-400 mb-2 flex items-center gap-1">
                                                <Icons.Link className="w-3 h-3" /> Hierarquia / Vínculo
                                            </label>
                                            <div className="relative">
                                                <select 
                                                    className="w-full text-xs p-2 border border-blue-200 rounded bg-white text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-300"
                                                    value={getParentId(selectedNode.id)}
                                                    onChange={(e) => handleRelinkNode(selectedNode.id, e.target.value)}
                                                >
                                                    <option value="">-- Sem vínculo --</option>
                                                    {availableParents.map(p => (
                                                        <option key={p.id} value={p.id}>
                                                            {p.label.substring(0, 30)}{p.label.length > 30 ? '...' : ''} ({p.type})
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>
                                            <p className="text-[10px] text-blue-400 mt-2 leading-tight">
                                                Selecione um novo "pai" para mover este item e herdar sua cor.
                                            </p>
                                        </div>
                                    )}

                                    {/* Seção de Cores */}
                                    <div>
                                        <label className="block text-[10px] font-bold uppercase text-slate-400 mb-2">Cor do Tema</label>
                                        <div className="grid grid-cols-5 gap-2">
                                            {Object.keys(THEMES).map(colorKey => (
                                                <button
                                                    key={colorKey}
                                                    onClick={() => handleUpdateNode(selectedNode.id, 'color', colorKey)}
                                                    className={`w-6 h-6 rounded-full border transition-transform hover:scale-110 flex items-center justify-center ${selectedNode.color === colorKey ? 'ring-2 ring-offset-2 ring-slate-400' : ''}`}
                                                    style={{ backgroundColor: THEMES[colorKey].main, borderColor: THEMES[colorKey].border }}
                                                />
                                            ))}
                                        </div>
                                    </div>

                                    {/* Botões de Ação */}
                                    <div className="pt-4 border-t border-slate-200">
                                        <label className="block text-[10px] font-bold uppercase text-slate-400 mb-2">Adicionar Filhos</label>
                                        <div className="grid grid-cols-1 gap-2">
                                            <button onClick={() => handleAddNode('attribute')} className="btn-add">
                                                <Icons.Layers className="w-3 h-3 text-blue-500" /> + Atributo
                                            </button>
                                            <button onClick={() => handleAddNode('action')} className="btn-add">
                                                <Icons.Play className="w-3 h-3 text-emerald-500" /> + Ação/Processo
                                            </button>
                                            <button onClick={() => handleAddNode('kpi')} className="btn-add">
                                                <Icons.BarChart3 className="w-3 h-3 text-purple-500" /> + KPI / Resultado
                                            </button>
                                        </div>
                                        
                                        <button 
                                            onClick={handleDeleteNode}
                                            className="w-full mt-4 flex items-center justify-center gap-2 text-red-600 hover:bg-red-50 p-2 rounded-md transition-colors text-xs font-bold uppercase border border-transparent hover:border-red-100"
                                        >
                                            <Icons.Trash2 className="w-3 h-3" /> Excluir
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-slate-400 text-center opacity-60">
                                    <Icons.MousePointer2 className="w-10 h-10 mb-2 text-slate-300" />
                                    <p className="text-xs">Selecione um item para editar, vincular ou colorir.</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* --- Canvas --- */}
                    <div 
                        ref={containerRef}
                        className="flex-1 relative overflow-hidden bg-slate-50/50 cursor-grab active:cursor-grabbing"
                        onMouseDown={handleMouseDown}
                        onMouseMove={handleMouseMove}
                        onMouseUp={handleMouseUp}
                        onMouseLeave={handleMouseUp}
                    >
                        {/* Grid e Linhas */}
                        <div 
                            className="absolute inset-0 pointer-events-none opacity-[0.05]"
                            style={{
                                backgroundImage: `linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)`,
                                backgroundSize: `${20 * scale}px ${20 * scale}px`,
                                backgroundPosition: `${pan.x}px ${pan.y}px`
                            }}
                        />

                        <div 
                            className="absolute origin-top-left transition-transform duration-75 ease-linear"
                            style={{ transform: `translate(${pan.x}px, ${pan.y}px) scale(${scale})` }}
                        >
                            <svg className="absolute top-0 left-0 w-[8000px] h-[8000px] pointer-events-none overflow-visible">
                                {edges.map(edge => {
                                    const source = nodes.find(n => n.id === edge.source);
                                    const target = nodes.find(n => n.id === edge.target);
                                    if (!source || !target) return null;
                                    const theme = THEMES[source.color] || THEMES.blue;
                                    return (
                                        <path
                                            key={edge.id}
                                            d={getPath(source, target)}
                                            stroke={theme.border}
                                            strokeWidth={source.type === 'dimension' ? 4 : 2} 
                                            fill="none"
                                        />
                                    );
                                })}
                            </svg>

                            {nodes.map(renderNode)}
                        </div>

                        {/* Botão Nova Dimensão */}
                        <button
                            onClick={() => { setSelectedNodeId(null); handleAddNode('dimension'); }}
                            className="absolute top-6 left-1/2 -translate-x-1/2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full shadow-lg font-bold flex items-center gap-2 transition-transform hover:scale-105 active:scale-95 z-50"
                        >
                            <Icons.Plus className="w-5 h-5" /> Nova Dimensão
                        </button>

                        {/* Controles Zoom */}
                        <div className="absolute bottom-6 right-6 flex gap-2">
                            <div className="bg-white p-1 rounded-lg shadow-lg border border-slate-200 flex flex-col gap-1">
                                <button onClick={() => setScale(s => Math.min(s + 0.1, 2))} className="p-2 hover:bg-slate-50 rounded text-slate-600"><Icons.ZoomIn className="w-5 h-5" /></button>
                                <button onClick={() => setScale(s => Math.max(s - 0.1, 0.2))} className="p-2 hover:bg-slate-50 rounded text-slate-600"><Icons.ZoomOut className="w-5 h-5" /></button>
                                <button onClick={() => { setScale(0.5); setPan({x:50, y:50}); }} className="p-2 hover:bg-slate-50 rounded text-slate-600"><Icons.Maximize className="w-5 h-5" /></button>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <style>
        .btn-add {
            @apply flex items-center gap-2 px-3 py-2 bg-slate-50 border border-slate-200 rounded-md hover:bg-white hover:shadow-sm text-xs font-medium text-slate-600 transition-all text-left;
        }
    </style>
</body>
</html>

